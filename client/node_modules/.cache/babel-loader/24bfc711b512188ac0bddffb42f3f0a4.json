{"ast":null,"code":"const api = require('./api');\n\nconst _require = require('../utils'),\n      isEmpty = _require.isEmpty,\n      isNumber = _require.isNumber;\n\nconst Search = class Search {\n  constructor() {\n    this.query_hash = {\n      sort_by: [],\n      aggregate: [],\n      with_field: []\n    };\n  }\n\n  static instance() {\n    return new Search();\n  }\n\n  static expression(value) {\n    return this.instance().expression(value);\n  }\n\n  static max_results(value) {\n    return this.instance().max_results(value);\n  }\n\n  static next_cursor(value) {\n    return this.instance().next_cursor(value);\n  }\n\n  static aggregate(value) {\n    return this.instance().aggregate(value);\n  }\n\n  static with_field(value) {\n    return this.instance().with_field(value);\n  }\n\n  static sort_by(field_name, dir = 'asc') {\n    return this.instance().sort_by(field_name, dir);\n  }\n\n  expression(value) {\n    this.query_hash.expression = value;\n    return this;\n  }\n\n  max_results(value) {\n    this.query_hash.max_results = value;\n    return this;\n  }\n\n  next_cursor(value) {\n    this.query_hash.next_cursor = value;\n    return this;\n  }\n\n  aggregate(value) {\n    this.query_hash.aggregate.push(value);\n    return this;\n  }\n\n  with_field(value) {\n    this.query_hash.with_field.push(value);\n    return this;\n  }\n\n  sort_by(field_name, dir = \"desc\") {\n    var sort_bucket;\n    sort_bucket = {};\n    sort_bucket[field_name] = dir;\n    this.query_hash.sort_by.push(sort_bucket);\n    return this;\n  }\n\n  to_query() {\n    Object.keys(this.query_hash).forEach(k => {\n      let v = this.query_hash[k];\n\n      if (!isNumber(v) && isEmpty(v)) {\n        delete this.query_hash[k];\n      }\n    });\n    return this.query_hash;\n  }\n\n  execute(options, callback) {\n    if (callback === null) {\n      callback = options;\n    }\n\n    options = options || {};\n    return api.search(this.to_query(), options, callback);\n  }\n\n};\nmodule.exports = Search;","map":null,"metadata":{},"sourceType":"script"}
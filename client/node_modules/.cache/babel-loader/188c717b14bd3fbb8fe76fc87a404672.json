{"ast":null,"code":"/**\n * Assign a value to a nested object\n * @function putNestedValue\n * @param params the parent object - this argument will be modified!\n * @param key key in the form nested[innerkey]\n * @param value the value to assign\n * @return the modified params object\n */\nconst url = require('url');\n\nconst extend = require(\"lodash/extend\");\n\nconst isObject = require(\"lodash/isObject\");\n\nconst isString = require(\"lodash/isString\");\n\nconst isUndefined = require(\"lodash/isUndefined\");\n\nconst entries = require('./utils/entries');\n\nlet cloudinary_config = void 0;\n/**\n * Sets a value in an object using a nested key\n * @param {object} params The object to assign the value in.\n * @param {string} key The key of the value. A period is used to denote inner keys.\n * @param {*} value The value to set.\n * @returns {object} The params argument.\n * @example\n *     let o = {foo: {bar: 1}};\n *     putNestedValue(o, 'foo.bar', 2); // {foo: {bar: 2}}\n *     putNestedValue(o, 'foo.inner.key', 'this creates an inner object');\n *     // {{foo: {bar: 2}, inner: {key: 'this creates an inner object'}}}\n */\n\nfunction putNestedValue(params, key, value) {\n  let chain = key.split(/[\\[\\]]+/).filter(i => i.length);\n  let outer = params;\n  let lastKey = chain.pop();\n\n  for (let j = 0; j < chain.length; j++) {\n    let innerKey = chain[j];\n    let inner = outer[innerKey];\n\n    if (inner == null) {\n      inner = {};\n      outer[innerKey] = inner;\n    }\n\n    outer = inner;\n  }\n\n  outer[lastKey] = value;\n  return params;\n}\n\nmodule.exports = function (new_config, new_value) {\n  if (cloudinary_config == null || new_config === true) {\n    if (cloudinary_config == null) {\n      cloudinary_config = {};\n    } else {\n      Object.keys(cloudinary_config).forEach(key => delete cloudinary_config[key]);\n    }\n\n    let cloudinary_url = process.env.CLOUDINARY_URL;\n\n    if (cloudinary_url != null) {\n      let uri = url.parse(cloudinary_url, true);\n      let parsedConfig = {\n        cloud_name: uri.host,\n        api_key: uri.auth && uri.auth.split(\":\")[0],\n        api_secret: uri.auth && uri.auth.split(\":\")[1],\n        private_cdn: uri.pathname != null,\n        secure_distribution: uri.pathname && uri.pathname.substring(1)\n      };\n      entries(parsedConfig).forEach(([key, value]) => {\n        if (value !== undefined) {\n          cloudinary_config[key] = value;\n        }\n      });\n\n      if (uri.query != null) {\n        entries(uri.query).forEach(([key, value]) => putNestedValue(cloudinary_config, key, value));\n      }\n    }\n  }\n\n  if (!isUndefined(new_value)) {\n    cloudinary_config[new_config] = new_value;\n  } else if (isString(new_config)) {\n    return cloudinary_config[new_config];\n  } else if (isObject(new_config)) {\n    extend(cloudinary_config, new_config);\n  }\n\n  return cloudinary_config;\n};","map":null,"metadata":{},"sourceType":"script"}